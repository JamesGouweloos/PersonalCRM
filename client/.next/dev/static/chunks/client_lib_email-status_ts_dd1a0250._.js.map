{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/CRM/client/lib/email-status.ts"],"sourcesContent":["// Local storage management for email read/unread status\r\n// This is app-only state and doesn't sync to the server\r\n\r\nconst STORAGE_KEY = \"crm_email_read_status\"\r\nconst AUTOSYNC_INTERVAL_KEY = \"crm_autosync_interval\"\r\nconst AUTOSYNC_ENABLED_KEY = \"crm_autosync_enabled\"\r\n\r\ninterface EmailReadStatus {\r\n  [emailId: string]: {\r\n    read: boolean\r\n    readAt?: string\r\n  }\r\n}\r\n\r\nexport function getEmailReadStatus(): EmailReadStatus {\r\n  if (typeof window === \"undefined\") return {}\r\n  const stored = localStorage.getItem(STORAGE_KEY)\r\n  return stored ? JSON.parse(stored) : {}\r\n}\r\n\r\nexport function setEmailReadStatus(emailId: string | number, read: boolean): void {\r\n  if (typeof window === \"undefined\") return\r\n  const status = getEmailReadStatus()\r\n  status[emailId.toString()] = {\r\n    read,\r\n    readAt: read ? new Date().toISOString() : undefined,\r\n  }\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(status))\r\n}\r\n\r\nexport function isEmailRead(emailId: string | number): boolean {\r\n  const status = getEmailReadStatus()\r\n  return status[emailId.toString()]?.read ?? false\r\n}\r\n\r\nexport function markEmailAsRead(emailId: string | number): void {\r\n  setEmailReadStatus(emailId, true)\r\n}\r\n\r\nexport function markEmailAsUnread(emailId: string | number): void {\r\n  setEmailReadStatus(emailId, false)\r\n}\r\n\r\nexport function markAllAsRead(emailIds: (string | number)[]): void {\r\n  if (typeof window === \"undefined\") return\r\n  const status = getEmailReadStatus()\r\n  emailIds.forEach((id) => {\r\n    status[id.toString()] = {\r\n      read: true,\r\n      readAt: new Date().toISOString(),\r\n    }\r\n  })\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(status))\r\n}\r\n\r\n// Mark new emails as unread (emails that don't have a status entry)\r\nexport function initializeEmailStatus(emailIds: (string | number)[]): void {\r\n  if (typeof window === \"undefined\") return\r\n  const status = getEmailReadStatus()\r\n  let updated = false\r\n  \r\n  emailIds.forEach((id) => {\r\n    const idStr = id.toString()\r\n    if (!(idStr in status)) {\r\n      // New email - mark as unread\r\n      status[idStr] = {\r\n        read: false,\r\n      }\r\n      updated = true\r\n    }\r\n  })\r\n  \r\n  if (updated) {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(status))\r\n  }\r\n}\r\n\r\nexport function getUnreadCount(emailIds: (string | number)[]): number {\r\n  const status = getEmailReadStatus()\r\n  return emailIds.filter((id) => !status[id.toString()]?.read).length\r\n}\r\n\r\n// Clean up stale email status entries (emails that no longer exist)\r\nexport function cleanupEmailStatus(existingEmailIds: (string | number)[]): void {\r\n  if (typeof window === \"undefined\") return\r\n  const status = getEmailReadStatus()\r\n  const existingIds = new Set(existingEmailIds.map(id => id.toString()))\r\n  let updated = false\r\n  \r\n  // Remove entries for emails that no longer exist\r\n  Object.keys(status).forEach((id) => {\r\n    if (!existingIds.has(id)) {\r\n      delete status[id]\r\n      updated = true\r\n    }\r\n  })\r\n  \r\n  if (updated) {\r\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(status))\r\n  }\r\n}\r\n\r\n// Autosync settings\r\nexport function getAutosyncInterval(): number {\r\n  if (typeof window === \"undefined\") return 5 * 60 * 1000 // Default 5 minutes\r\n  const stored = localStorage.getItem(AUTOSYNC_INTERVAL_KEY)\r\n  return stored ? parseInt(stored, 10) : 5 * 60 * 1000\r\n}\r\n\r\nexport function setAutosyncInterval(intervalMs: number): void {\r\n  if (typeof window === \"undefined\") return\r\n  localStorage.setItem(AUTOSYNC_INTERVAL_KEY, intervalMs.toString())\r\n}\r\n\r\nexport function isAutosyncEnabled(): boolean {\r\n  if (typeof window === \"undefined\") return true\r\n  const stored = localStorage.getItem(AUTOSYNC_ENABLED_KEY)\r\n  return stored ? stored === \"true\" : true\r\n}\r\n\r\nexport function setAutosyncEnabled(enabled: boolean): void {\r\n  if (typeof window === \"undefined\") return\r\n  localStorage.setItem(AUTOSYNC_ENABLED_KEY, enabled.toString())\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"AAAA,wDAAwD;AACxD,wDAAwD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAExD,MAAM,cAAc;AACpB,MAAM,wBAAwB;AAC9B,MAAM,uBAAuB;AAStB,SAAS;IACd;;IACA,MAAM,SAAS,aAAa,OAAO,CAAC;IACpC,OAAO,SAAS,KAAK,KAAK,CAAC,UAAU,CAAC;AACxC;AAEO,SAAS,mBAAmB,OAAwB,EAAE,IAAa;IACxE;;IACA,MAAM,SAAS;IACf,MAAM,CAAC,QAAQ,QAAQ,GAAG,GAAG;QAC3B;QACA,QAAQ,OAAO,IAAI,OAAO,WAAW,KAAK;IAC5C;IACA,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;AACnD;AAEO,SAAS,YAAY,OAAwB;IAClD,MAAM,SAAS;IACf,OAAO,MAAM,CAAC,QAAQ,QAAQ,GAAG,EAAE,QAAQ;AAC7C;AAEO,SAAS,gBAAgB,OAAwB;IACtD,mBAAmB,SAAS;AAC9B;AAEO,SAAS,kBAAkB,OAAwB;IACxD,mBAAmB,SAAS;AAC9B;AAEO,SAAS,cAAc,QAA6B;IACzD;;IACA,MAAM,SAAS;IACf,SAAS,OAAO,CAAC,CAAC;QAChB,MAAM,CAAC,GAAG,QAAQ,GAAG,GAAG;YACtB,MAAM;YACN,QAAQ,IAAI,OAAO,WAAW;QAChC;IACF;IACA,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;AACnD;AAGO,SAAS,sBAAsB,QAA6B;IACjE;;IACA,MAAM,SAAS;IACf,IAAI,UAAU;IAEd,SAAS,OAAO,CAAC,CAAC;QAChB,MAAM,QAAQ,GAAG,QAAQ;QACzB,IAAI,CAAC,CAAC,SAAS,MAAM,GAAG;YACtB,6BAA6B;YAC7B,MAAM,CAAC,MAAM,GAAG;gBACd,MAAM;YACR;YACA,UAAU;QACZ;IACF;IAEA,IAAI,SAAS;QACX,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;IACnD;AACF;AAEO,SAAS,eAAe,QAA6B;IAC1D,MAAM,SAAS;IACf,OAAO,SAAS,MAAM,CAAC,CAAC,KAAO,CAAC,MAAM,CAAC,GAAG,QAAQ,GAAG,EAAE,MAAM,MAAM;AACrE;AAGO,SAAS,mBAAmB,gBAAqC;IACtE;;IACA,MAAM,SAAS;IACf,MAAM,cAAc,IAAI,IAAI,iBAAiB,GAAG,CAAC,CAAA,KAAM,GAAG,QAAQ;IAClE,IAAI,UAAU;IAEd,iDAAiD;IACjD,OAAO,IAAI,CAAC,QAAQ,OAAO,CAAC,CAAC;QAC3B,IAAI,CAAC,YAAY,GAAG,CAAC,KAAK;YACxB,OAAO,MAAM,CAAC,GAAG;YACjB,UAAU;QACZ;IACF;IAEA,IAAI,SAAS;QACX,aAAa,OAAO,CAAC,aAAa,KAAK,SAAS,CAAC;IACnD;AACF;AAGO,SAAS;IACd;;KAAwD,oBAAoB;IAC5E,MAAM,SAAS,aAAa,OAAO,CAAC;IACpC,OAAO,SAAS,SAAS,QAAQ,MAAM,IAAI,KAAK;AAClD;AAEO,SAAS,oBAAoB,UAAkB;IACpD;;IACA,aAAa,OAAO,CAAC,uBAAuB,WAAW,QAAQ;AACjE;AAEO,SAAS;IACd;;IACA,MAAM,SAAS,aAAa,OAAO,CAAC;IACpC,OAAO,SAAS,WAAW,SAAS;AACtC;AAEO,SAAS,mBAAmB,OAAgB;IACjD;;IACA,aAAa,OAAO,CAAC,sBAAsB,QAAQ,QAAQ;AAC7D"}}]
}